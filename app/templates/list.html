<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–õ—é–¥–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --bg:#f6fbff; --card:#fff; --text:#0b1b20; --muted:#6b7a80;
      --primary:#1dd3b0; --primary-2:#2e7de9; --border:#e8eef4; --ring: rgba(46,125,233,.35);
    }
    *{box-sizing:border-box}
    body{ margin:0; background:var(--bg); color:var(--text); font:15px/1.5 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;}
    header.hero{ padding:24px; background:linear-gradient(135deg, var(--primary), var(--primary-2)); color:#fff; box-shadow: inset 0 -1px rgba(0,0,0,.08); }
    .wrap{ max-width: 1000px; margin: 0 auto; padding: 20px 24px 40px; }
    .actions a, .actions button{ display:inline-block; padding:8px 12px; border-radius:12px; text-decoration:none; border:0; cursor:pointer }
    .btn{ background:#eef5ff; color:#1b3b6b }
    .btn-primary{ background:linear-gradient(135deg, var(--primary), var(--primary-2)); color:#fff; box-shadow:0 10px 20px rgba(46,125,233,.2) }
    table{ width:100%; border-collapse:separate; border-spacing:0 10px; }
    th{ text-align:left; font-weight:700; color:#123; padding:0 12px 6px }
    td{ background:var(--card); border:1px solid var(--border); border-left:0; border-right:0; padding:14px 12px; box-shadow:0 10px 20px rgba(0,0,0,.06); }
    tr td:first-child{ border-radius:14px 0 0 14px; border-left:1px solid var(--border);}
    tr td:last-child{ border-radius:0 14px 14px 0; border-right:1px solid var(--border);}
    .muted{ color:var(--muted) }
    .avatar{
      width:40px; height:40px; border-radius:999px; object-fit:cover; border:2px solid #fff; margin-right:8px;
      background:linear-gradient(135deg,#dffaf3,#e6f0ff); display:inline-flex; align-items:center; justify-content:center; font-weight:800; color:#234; letter-spacing:.5px;
      box-shadow:0 6px 14px rgba(0,0,0,.12);
      flex: 0 0 auto;
    }
    a{ color: var(--primary-2); text-decoration: none; }
  </style>
</head>
<body data-page="list-v2">
  <header class="hero">
    <div class="wrap" style="display:flex; justify-content:space-between; align-items:center;">
      <h2 style="margin:0">–õ—é–¥–∏</h2>
      <a class="actions btn-primary" href="/person/new">+ –î–æ–±–∞–≤–∏—Ç—å</a>
    </div>
  </header>

  <div class="wrap">
    <table>
      <thead>
        <tr>
          <th>–ß–µ–ª–æ–≤–µ–∫</th>
          <th>–ö–æ–Ω—Ç–∞–∫—Ç—ã</th>
          <th>–ì–æ—Ä–æ–¥</th>
          <th>–î–† / –í–æ–∑—Ä–∞—Å—Ç</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      {% for p in people %}
        {% set initials = ((p.first_name[0] if p.first_name else '') + (p.last_name[0] if p.last_name else '')).upper() %}
        <tr>
          <td>
            <div style="display:flex; align-items:center;">
              {% if p.avatar_path %}
                <img class="avatar" src="{{ p.avatar_path }}" alt="">
              {% else %}
                <div class="avatar">{{ initials or 'üë§' }}</div>
              {% endif %}
              <a href="/person/{{ p.id }}">{{ p.last_name or '' }} {{ p.first_name or '' }}</a>
            </div>
          </td>
          <td>
            {% if p.phone %}üìû {{ p.phone }}<br>{% endif %}
            {% if p.email %}‚úâÔ∏è {{ p.email }}{% endif %}
          </td>
          <td>{{ p.city or '' }}</td>
          <td>
            {% if p.birth_day or p.birth_month or p.birth_year %}
              {% if p.birth_day %}{{ "%02d"|format(p.birth_day) }}.{% else %}??.{% endif %} 
              {% if p.birth_month %}{{ "%02d"|format(p.birth_month) }}.{% else %}??.{% endif %} 
              {% if p.birth_year %}{{ p.birth_year }}{% endif %}
            {% else %}
              <span class="muted">‚Äî</span>
            {% endif %}
            {% set age = calc_age(p.birth_day, p.birth_month, p.birth_year) %}
            {% if age is not none %}<div class="muted">{{ age }} –ª–µ—Ç</div>{% endif %}
          </td>
          <td class="actions" style="white-space:nowrap">
            <a class="btn" href="/person/{{ p.id }}/edit">–ò–∑–º–µ–Ω–∏—Ç—å</a>
            <form method="post" action="/person/{{ p.id }}/delete" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞ –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?')" style="display:inline">
              <button class="btn" style="background:#ff3b30; color:#fff;">–£–¥–∞–ª–∏—Ç—å</button>
            </form>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</body>
</html>
