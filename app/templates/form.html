<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>{{ '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' if p else '–ù–æ–≤—ã–π —á–µ–ª–æ–≤–µ–∫' }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --bg:#f6fbff; --card:#ffffff; --text:#0b1b20; --muted:#6b7a80;
      --primary:#1dd3b0; --primary-2:#2e7de9; --ring: rgba(46,125,233,.35); --border:#e8eef4;
    }
    *{box-sizing:border-box}
    body { margin: 0; background: var(--bg); color: var(--text); font: 15px/1.5 Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;}
    header.hero{ padding: 28px 24px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); color:#fff; box-shadow: inset 0 -1px rgba(0,0,0,.08); }
    .wrap{ max-width: 980px; margin: 0 auto; padding: 20px 24px 40px;}
    h1,h2{margin:0 0 8px}
    .card{ background: var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 12px 24px rgba(0,0,0,.06);}
    fieldset{ border:0; padding:0; margin: 14px 0 0}
    legend{ font-weight:600; margin-bottom:10px}
    .grid{ display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); }
    label{ display:flex; flex-direction:column; gap:6px; font-weight:600; color:#123}
    input, select, textarea{
      appearance:none; border:1px solid var(--border); border-radius:12px; padding:10px 12px; background:#fff;
      box-shadow:0 1px 0 #fff inset; outline: none;
    }
    textarea{ min-height: 90px; }
    input:focus, select:focus, textarea:focus{ border-color: var(--primary-2); box-shadow: 0 0 0 4px var(--ring); }
    .actions{ display:flex; gap:10px; margin-top:14px}
    button{ border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%); color:#fff; box-shadow:0 8px 18px rgba(46,125,233,.25); }
    .secondary{ background:#eef5ff; color:#1b3b6b }
    .avatar-preview{ display:flex; align-items:center; gap:16px; margin-bottom:8px; }
    .avatar{ width:72px; height:72px; border-radius:999px; object-fit:cover; border:3px solid #fff; box-shadow:0 4px 14px rgba(0,0,0,.12); background:linear-gradient(135deg,#dffaf3,#e6f0ff); display:flex; align-items:center; justify-content:center; font-weight:800; color:#234; letter-spacing:.5px; }
    a{ color: var(--primary-2); text-decoration: none; }
  </style>
</head>
<body>
  <header class="hero">
    <div class="wrap">
      <h2>{{ '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' if p else '–ù–æ–≤—ã–π —á–µ–ª–æ–≤–µ–∫' }}</h2>
      <div style="opacity:.85">–ö–∞—Ä—Ç–æ—á–∫–∞ —Å—Ç–∞–ª–∞ –µ—â—ë –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–µ–µ ‚ú®</div>
    </div>
  </header>

  <div class="wrap">
    <div class="card">
      <form method="post" enctype="multipart/form-data" action="{{ '/person/' ~ p.id ~ '/update' if p else '/person/create' }}">
        <fieldset>
          <legend>–ê–≤–∞—Ç–∞—Ä</legend>
          <div class="avatar-preview">
            {% set initials = ((p.first_name[0] if p and p.first_name else '') + (p.last_name[0] if p and p.last_name else '')).upper() %}
            {% if p and p.avatar_path %}
              <img class="avatar" src="{{ p.avatar_path }}" alt="">
            {% else %}
              <div class="avatar">{{ initials or 'üë§' }}</div>
            {% endif %}
            <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
              <input type="file" name="avatar" accept="image/*">
            </label>
          </div>
        </fieldset>

        <fieldset>
          <legend>–û—Å–Ω–æ–≤–Ω–æ–µ</legend>
          <div class="grid">
            <label>–ò–º—è <input name="first_name" value="{{ p.first_name if p else '' }}"></label>
            <label>–§–∞–º–∏–ª–∏—è <input name="last_name" value="{{ p.last_name if p else '' }}"></label>
            <label>–¢–µ–ª–µ—Ñ–æ–Ω <input name="phone" value="{{ p.phone if p else '' }}"></label>
            <label>Email <input name="email" value="{{ p.email if p else '' }}"></label>
            <label>–ì–æ—Ä–æ–¥ <input name="city" value="{{ p.city if p else '' }}"></label>
            <label>–ê–¥—Ä–µ—Å <input name="address" value="{{ p.address if p else '' }}"></label>
            <label>–ö–≤–∞—Ä—Ç–∏—Ä–∞ <input name="apartment" value="{{ p.apartment if p else '' }}"></label>
          </div>
        </fieldset>

        <fieldset>
          <legend>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</legend>
          <div class="grid">
            <label>–î–µ–Ω—å <input type="number" min="1" max="31" name="birth_day" value="{{ p.birth_day if p else '' }}"></label>
            <label>–ú–µ—Å—è—Ü <input type="number" min="1" max="12" name="birth_month" value="{{ p.birth_month if p else '' }}"></label>
            <label>–ì–æ–¥ <input type="number" min="1900" max="2100" name="birth_year" value="{{ p.birth_year if p else '' }}"></label>
          </div>
        </fieldset>

        <fieldset>
          <legend>–õ—é–±–∏–º–æ–µ</legend>
          <div class="grid">
            <label>–§–∏–ª—å–º—ã/—Å–µ—Ä–∏–∞–ª—ã <input name="favorite_movies" value="{{ p.favorite_movies if p else '' }}"></label>
            <label>–õ—é–±–∏–º—ã–π —Ü–≤–µ—Ç <input name="favorite_color" value="{{ p.favorite_color if p else '' }}"></label>
            <label>–õ—é–±–∏–º—ã–µ —Ü–≤–µ—Ç—ã <input name="favorite_flowers" value="{{ p.favorite_flowers if p else '' }}"></label>
          </div>
        </fieldset>

        <fieldset>
          <legend>–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</legend>
          <div class="grid">
            <label>–ï–¥–∞
              <textarea name="food_prefs" placeholder="–õ—é–±–∏–º—ã–µ –∫—É—Ö–Ω–∏, –±–ª—é–¥–∞">{{ p.food_prefs if p else '' }}</textarea>
            </label>
            <label>–ê–ª–∫–æ–≥–æ–ª—å
              <textarea name="alcohol_prefs" placeholder="–ß—Ç–æ –ø—å—ë—Ç/–Ω–µ –ø—å—ë—Ç, –ª—é–±–∏–º—ã–µ –Ω–∞–ø–∏—Ç–∫–∏">{{ p.alcohol_prefs if p else '' }}</textarea>
            </label>
            <label>–ö—É–¥–∞ —Å—Ö–æ–¥–∏—Ç—å/–ø–æ–≥—É–ª—è—Ç—å
              <textarea name="places_to_go" placeholder="–õ—é–±–∏–º—ã–µ –º–µ—Å—Ç–∞, –º–∞—Ä—à—Ä—É—Ç—ã">{{ p.places_to_go if p else '' }}</textarea>
            </label>
          </div>
        </fieldset>

        <fieldset>
          <legend>–•–∞—Ä–∞–∫—Ç–µ—Ä</legend>
          <div class="grid">
            <label>–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞
              <textarea name="traits_positive">{{ p.traits_positive if p else '' }}</textarea>
            </label>
            <label>–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞
              <textarea name="traits_negative">{{ p.traits_negative if p else '' }}</textarea>
            </label>
          </div>
        </fieldset>

        <fieldset>
          <legend>–†–∞–±–æ—Ç–∞</legend>
          <div class="grid">
            <label>–ì–¥–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
              <input name="workplace" placeholder="–ö–æ–º–ø–∞–Ω–∏—è/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è" value="{{ p.workplace if p else '' }}">
            </label>
            <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å
              <input name="job_title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Senior Engineer" value="{{ p.job_title if p else '' }}">
            </label>
          </div>
        </fieldset>

        <fieldset>
          <legend>–ü–æ–∂–µ–ª–∞–Ω–∏—è –Ω–∞ –î–†</legend>
          <label>
            <textarea name="wishlist" placeholder="–ß—Ç–æ –±—ã —Ö–æ—Ç–µ–ª(–∞) –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è">{{ p.wishlist if p else '' }}</textarea>
          </label>
        </fieldset>

        <fieldset>
          <legend>–°–æ—Ü—Å–µ—Ç–∏ (—Ç–æ–ª—å–∫–æ –Ω–∏–∫)</legend>
          <div class="grid">
            <label>Telegram
              <input name="telegram_username" placeholder="–Ω–∏–∫ –±–µ–∑ @" value="{{ p.telegram_username if p else '' }}">
            </label>
            <label>Instagram
              <input name="instagram_username" placeholder="–Ω–∏–∫ –±–µ–∑ @" value="{{ p.instagram_username if p else '' }}">
            </label>
            <label>VK
              <input name="vk_username" placeholder="–Ω–∏–∫ –±–µ–∑ @" value="{{ p.vk_username if p else '' }}">
            </label>
          </div>
        </fieldset>

        <fieldset>
          <legend>–õ–∏—á–Ω–æ–µ</legend>
          <div class="grid">
            <label>–°–µ–º–µ–π–Ω—ã–π —Å—Ç–∞—Ç—É—Å
              <select name="marital_status" id="marital_status">
                {% set ms = p.marital_status if p else '' %}
                <option value="">‚Äî</option>
                <option value="single"    {{ 'selected' if ms=='single' }}>–û–¥–∏–Ω–æ–∫(–∞)</option>
                <option value="married"   {{ 'selected' if ms=='married' }}>–ñ–µ–Ω–∞—Ç(–∞)</option>
                <option value="partnered" {{ 'selected' if ms=='partnered' }}>–ï—Å—Ç—å –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∫–∞</option>
              </select>
            </label>
            <label id="partner_name_wrap" style="display:none">–ò–º—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞
              <input name="partner_name" value="{{ p.partner_name if p else '' }}">
            </label>
            <label>–õ–µ–≤—à–∞/–ü—Ä–∞–≤—à–∞
              <select name="handedness">
                {% set h = p.handedness if p else '' %}
                <option value="">‚Äî</option>
                <option value="right" {{ 'selected' if h=='right' }}>–ü—Ä–∞–≤—à–∞</option>
                <option value="left"  {{ 'selected' if h=='left'  }}>–õ–µ–≤—à–∞</option>
                <option value="ambi"  {{ 'selected' if h=='ambi'  }}>–ê–º–±–∏–¥–µ–∫—Å—Ç—Ä</option>
              </select>
            </label>
            <label>–ö—É—Ä–∏—Ç?
              {% set s = p.smokes if p is not none else None %}
              <select name="smokes">
                <option value=""  {{ 'selected' if s is none }}>‚Äî</option>
                <option value="1" {{ 'selected' if s is true }}>–î–∞</option>
                <option value="0" {{ 'selected' if s is false }}>–ù–µ—Ç</option>
              </select>
            </label>
          </div>
        </fieldset>

        <div class="actions">
          <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <a class="secondary" href="{{ '/person/' ~ p.id if p else '/' }}" style="padding:12px 16px; border-radius:12px; text-decoration:none;">–û—Ç–º–µ–Ω–∞</a>
        </div>
      </form>

      {% if p %}
      <form method="post" action="/person/{{ p.id }}/delete" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞ –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?')" style="margin-top:10px">
        <button class="secondary" style="background:#ff3b30; color:#fff;">–£–¥–∞–ª–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞</button>
      </form>
      {% endif %}
    </div>
  </div>

  <script>
  (function() {
    function togglePartner() {
      var sel = document.getElementById('marital_status');
      var wrap = document.getElementById('partner_name_wrap');
      if (!sel || !wrap) return;
      var v = sel.value;
      wrap.style.display = (v === 'married' || v === 'partnered') ? '' : 'none';
    }
    document.addEventListener('DOMContentLoaded', togglePartner);
    document.getElementById('marital_status')?.addEventListener('change', togglePartner);
  })();
  </script>
</body>
</html>
